<?php

namespace Nuada\ApiBundle\Entity;

use Doctrine\ORM\EntityRepository;

/**
 * ListingRepository
 *
 * This class was generated by the Doctrine ORM. 
 */
class ListingRepository extends EntityRepository
{
	/**
     * Retrieve All
     *
     * @param integer $id          - Listing Id
     * @param boolean $withDeleted - With deleted listing
     *
     * @return array
     */
    public function retrieveAll($id=null, $limit = null, $offset = null, $withDeleted=false)
    {
    	if (!is_null($id)) {
        	return $this->find($id);
        }

        $qb = $this->createQueryBuilder('e');


        if (!$withDeleted) {
            $qb = $qb->andWhere('e.deleted = false');
        }
        
        if ($offset) {
            $qb->setMaxResults($limit);
            $qb->setFirstResult($offset);
        }

        if ($limit && !$offset) {
            $qb->setMaxResults($limit);
        }

        $query = $qb->getQuery();


        return $query->getResult();
    }
}
